<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Imaging a Black Hole using only Closure Quantities | Comrade.jl</title>
    <meta name="description" content="A VitePress Site">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/Comrade.jl/previews/PR397/assets/style.CDzfV_Py.css" as="style">
    <link rel="preload stylesheet" href="/Comrade.jl/previews/PR397/vp-icons.css" as="style">
    
    <script type="module" src="/Comrade.jl/previews/PR397/assets/app.BdNt68ec.js"></script>
    <link rel="preload" href="/Comrade.jl/previews/PR397/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/Comrade.jl/previews/PR397/assets/chunks/theme.Bai9DML_.js">
    <link rel="modulepreload" href="/Comrade.jl/previews/PR397/assets/chunks/framework.BtlTykxb.js">
    <link rel="modulepreload" href="/Comrade.jl/previews/PR397/assets/tutorials_intermediate_ClosureImaging.md.BEP1leop.lean.js">
    <link rel="icon" href="REPLACE_ME_DOCUMENTER_VITEPRESS_FAVICON">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-a9a9e638><!--[--><!--]--><!--[--><span tabindex="-1" data-v-492508fc></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-492508fc>Skip to content</a><!--]--><!----><header class="VPNav" data-v-a9a9e638 data-v-f1e365da><div class="VPNavBar" data-v-f1e365da data-v-822684d1><div class="wrapper" data-v-822684d1><div class="container" data-v-822684d1><div class="title" data-v-822684d1><div class="VPNavBarTitle has-sidebar" data-v-822684d1 data-v-0f4f798b><a class="title" href="/Comrade.jl/previews/PR397/" data-v-0f4f798b><!--[--><!--]--><!----><span data-v-0f4f798b>Comrade.jl</span><!--[--><!--]--></a></div></div><div class="content" data-v-822684d1><div class="content-body" data-v-822684d1><!--[--><!--]--><div class="VPNavBarSearch search" data-v-822684d1><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-822684d1 data-v-e6d46098><span id="main-nav-aria-label" class="visually-hidden" data-v-e6d46098> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Comrade.jl/previews/PR397/index" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Comrade.jl/previews/PR397/introduction" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>Introduction</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Comrade.jl/previews/PR397/benchmarks" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>Benchmarks</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Comrade.jl/previews/PR397/vlbi_imaging_problem" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>Introduction to the VLBI Imaging Problem</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Comrade.jl/previews/PR397/conventions" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>Conventions</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Tutorials</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/Comrade.jl/previews/PR397/tutorials/index" data-v-acbfed09><!--[--><span data-v-acbfed09>Overview</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuGroup" data-v-7dd3104a data-v-48c802d0><p class="title" data-v-48c802d0>Beginner</p><!--[--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-acbfed09><a class="VPLink link" href="/Comrade.jl/previews/PR397/tutorials/beginner/LoadingData" data-v-acbfed09><!--[--><span data-v-acbfed09>Loading Data into Comrade</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-acbfed09><a class="VPLink link" href="/Comrade.jl/previews/PR397/tutorials/beginner/GeometricModeling" data-v-acbfed09><!--[--><span data-v-acbfed09>Geometric Modeling of EHT Data</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-7dd3104a data-v-48c802d0><p class="title" data-v-48c802d0>Intermediate</p><!--[--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-acbfed09><a class="VPLink link active" href="/Comrade.jl/previews/PR397/tutorials/intermediate/ClosureImaging" data-v-acbfed09><!--[--><span data-v-acbfed09>Imaging a Black Hole using only Closure Quantities</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-acbfed09><a class="VPLink link" href="/Comrade.jl/previews/PR397/tutorials/intermediate/StokesIImaging" data-v-acbfed09><!--[--><span data-v-acbfed09>Stokes I Simultaneous Image and Instrument Modeling</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-acbfed09><a class="VPLink link" href="/Comrade.jl/previews/PR397/tutorials/intermediate/PolarizedImaging" data-v-acbfed09><!--[--><span data-v-acbfed09>Polarized Image and Instrumental Modeling</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-7dd3104a data-v-48c802d0><p class="title" data-v-48c802d0>Advanced</p><!--[--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-acbfed09><a class="VPLink link" href="/Comrade.jl/previews/PR397/tutorials/advanced/HybridImaging" data-v-acbfed09><!--[--><span data-v-acbfed09>Hybrid Imaging of a Black Hole</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Extensions</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/Comrade.jl/previews/PR397/ext/optimization" data-v-acbfed09><!--[--><span data-v-acbfed09>Optimization Extension</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/Comrade.jl/previews/PR397/ext/ahmc" data-v-acbfed09><!--[--><span data-v-acbfed09>AdvancedHMC Extension</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/Comrade.jl/previews/PR397/ext/dynesty" data-v-acbfed09><!--[--><span data-v-acbfed09>Dynesty Extension</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/Comrade.jl/previews/PR397/ext/pigeons" data-v-acbfed09><!--[--><span data-v-acbfed09>Pigeons Extension</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Comrade.jl/previews/PR397/base_api" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>Base API</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Comrade.jl/previews/PR397/api" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>Comrade API</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-822684d1 data-v-af096f4a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-af096f4a data-v-e40a8bb6 data-v-4a1c76db><span class="check" data-v-4a1c76db><span class="icon" data-v-4a1c76db><!--[--><span class="vpi-sun sun" data-v-e40a8bb6></span><span class="vpi-moon moon" data-v-e40a8bb6></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-822684d1 data-v-164c457f data-v-ee7a9424><!--[--><a class="VPSocialLink no-icon" href="https://github.com/ptiede/Comrade.jl" aria-label="github" target="_blank" rel="noopener" data-v-ee7a9424 data-v-d26d30cb><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-822684d1 data-v-925effce data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-04f5c5e9><span class="vpi-more-horizontal icon" data-v-04f5c5e9></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><!----><!--[--><!--[--><!----><div class="group" data-v-925effce><div class="item appearance" data-v-925effce><p class="label" data-v-925effce>Appearance</p><div class="appearance-action" data-v-925effce><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-925effce data-v-e40a8bb6 data-v-4a1c76db><span class="check" data-v-4a1c76db><span class="icon" data-v-4a1c76db><!--[--><span class="vpi-sun sun" data-v-e40a8bb6></span><span class="vpi-moon moon" data-v-e40a8bb6></span><!--]--></span></span></button></div></div></div><div class="group" data-v-925effce><div class="item social-links" data-v-925effce><div class="VPSocialLinks social-links-list" data-v-925effce data-v-ee7a9424><!--[--><a class="VPSocialLink no-icon" href="https://github.com/ptiede/Comrade.jl" aria-label="github" target="_blank" rel="noopener" data-v-ee7a9424 data-v-d26d30cb><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-822684d1 data-v-5dea55bf><span class="container" data-v-5dea55bf><span class="top" data-v-5dea55bf></span><span class="middle" data-v-5dea55bf></span><span class="bottom" data-v-5dea55bf></span></span></button></div></div></div></div><div class="divider" data-v-822684d1><div class="divider-line" data-v-822684d1></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-a9a9e638 data-v-070ab83d><div class="container" data-v-070ab83d><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-070ab83d><span class="vpi-align-left menu-icon" data-v-070ab83d></span><span class="menu-text" data-v-070ab83d>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-070ab83d data-v-168ddf5d><button data-v-168ddf5d>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-a9a9e638 data-v-18756405><div class="curtain" data-v-18756405></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-18756405><span class="visually-hidden" id="sidebar-aria-label" data-v-18756405> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-a4b0d9bf><!----><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/index" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Home</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/introduction" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Introduction</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/benchmarks" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Benchmarks</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/vlbi_imaging_problem" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Introduction to the VLBI Imaging Problem</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/conventions" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Conventions</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0 collapsible has-active" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>Tutorials</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-a4b0d9bf><span class="vpi-chevron-right caret-icon" data-v-a4b0d9bf></span></div></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/tutorials/index" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Overview</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 collapsible" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h3 class="text" data-v-a4b0d9bf>Beginner</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-a4b0d9bf><span class="vpi-chevron-right caret-icon" data-v-a4b0d9bf></span></div></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-2 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/tutorials/beginner/LoadingData" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Loading Data into Comrade</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/tutorials/beginner/GeometricModeling" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Geometric Modeling of EHT Data</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible has-active" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h3 class="text" data-v-a4b0d9bf>Intermediate</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-a4b0d9bf><span class="vpi-chevron-right caret-icon" data-v-a4b0d9bf></span></div></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-2 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/tutorials/intermediate/ClosureImaging" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Imaging a Black Hole using only Closure Quantities</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/tutorials/intermediate/StokesIImaging" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Stokes I Simultaneous Image and Instrument Modeling</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/tutorials/intermediate/PolarizedImaging" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Polarized Image and Instrumental Modeling</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h3 class="text" data-v-a4b0d9bf>Advanced</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-a4b0d9bf><span class="vpi-chevron-right caret-icon" data-v-a4b0d9bf></span></div></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-2 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/tutorials/advanced/HybridImaging" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Hybrid Imaging of a Black Hole</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0 collapsible" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>Extensions</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-a4b0d9bf><span class="vpi-chevron-right caret-icon" data-v-a4b0d9bf></span></div></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/ext/optimization" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Optimization Extension</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/ext/ahmc" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>AdvancedHMC Extension</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/ext/dynesty" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Dynesty Extension</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/ext/pigeons" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Pigeons Extension</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-a4b0d9bf><!----><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/base_api" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Base API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/Comrade.jl/previews/PR397/api" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Comrade API</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-a9a9e638 data-v-91765379><div class="VPDoc has-sidebar has-aside" data-v-91765379 data-v-83890dd9><!--[--><!--]--><div class="container" data-v-83890dd9><div class="aside" data-v-83890dd9><div class="aside-curtain" data-v-83890dd9></div><div class="aside-container" data-v-83890dd9><div class="aside-content" data-v-83890dd9><div class="VPDocAside" data-v-83890dd9 data-v-6d7b3c46><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-6d7b3c46 data-v-b38bf2ff><div class="content" data-v-b38bf2ff><div class="outline-marker" data-v-b38bf2ff></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-b38bf2ff>On this page</div><ul class="VPDocOutlineItem root" data-v-b38bf2ff data-v-3f927ebe><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-6d7b3c46></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-83890dd9><div class="content-container" data-v-83890dd9><!--[--><!--]--><main class="main" data-v-83890dd9><div style="position:relative;" class="vp-doc _Comrade_jl_previews_PR397_tutorials_intermediate_ClosureImaging" data-v-83890dd9><div><h1 id="Imaging-a-Black-Hole-using-only-Closure-Quantities" tabindex="-1">Imaging a Black Hole using only Closure Quantities <a class="header-anchor" href="#Imaging-a-Black-Hole-using-only-Closure-Quantities" aria-label="Permalink to &quot;Imaging a Black Hole using only Closure Quantities {#Imaging-a-Black-Hole-using-only-Closure-Quantities}&quot;">​</a></h1><p>In this tutorial, we will create a preliminary reconstruction of the 2017 M87 data on April 6 using closure-only imaging. This tutorial is a general introduction to closure-only imaging in Comrade. For an introduction to simultaneous image and instrument modeling, see <a href="/Comrade.jl/previews/PR397/tutorials/intermediate/StokesIImaging#Stokes-I-Simultaneous-Image-and-Instrument-Modeling">Stokes I Simultaneous Image and Instrument Modeling</a></p><h2 id="Introduction-to-Closure-Imaging" tabindex="-1">Introduction to Closure Imaging <a class="header-anchor" href="#Introduction-to-Closure-Imaging" aria-label="Permalink to &quot;Introduction to Closure Imaging {#Introduction-to-Closure-Imaging}&quot;">​</a></h2><p>The EHT is one of the highest-resolution telescope ever created. Its resolution is equivalent to roughly tracking a hockey puck on the moon when viewing it from the earth. However, the EHT is also a unique interferometer. First, EHT data is incredibly sparse, the array is formed from only eight geographic locations around the planet. Second, the obseving frequency is much higher than traditional VLBI. Lastly, each site in the array is unique. They have different dishes, recievers, feeds, and electronics. Putting this all together implies that many of the common imaging techniques struggle to fit the EHT data and explore the uncertainty in both the image and instrument. One way to deal with some of these uncertainties is to not directly fit the data but instead fit closure quantities, which are independent of many of the instrumental effects that plague the data. The types of closure quantities are briefly described in <a href="/Comrade.jl/previews/PR397/vlbi_imaging_problem#Introduction-to-the-VLBI-Imaging-Problem">Introduction to the VLBI Imaging Problem</a>.</p><p>In this tutorial, we will do closure-only modeling of M87 to produce a posterior of images of M87.</p><p>To get started, we will load Comrade</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Comrade</span></span></code></pre></div><p>Pyehtim loads eht-imaging using PythonCall this is necessary to load uvfits files currently.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Pyehtim</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>    CondaPkg Found dependencies: /home/runner/.julia/packages/DimensionalData/M9vEC/CondaPkg.toml</span></span>
<span class="line"><span>    CondaPkg Found dependencies: /home/runner/.julia/packages/PythonCall/WMWY0/CondaPkg.toml</span></span>
<span class="line"><span>    CondaPkg Found dependencies: /home/runner/.julia/packages/Pyehtim/Fm109/CondaPkg.toml</span></span>
<span class="line"><span>    CondaPkg Resolving changes</span></span>
<span class="line"><span>             + ehtim (pip)</span></span>
<span class="line"><span>             + libstdcxx-ng</span></span>
<span class="line"><span>             + numpy</span></span>
<span class="line"><span>             + numpy (pip)</span></span>
<span class="line"><span>             + openssl</span></span>
<span class="line"><span>             + pandas</span></span>
<span class="line"><span>             + python</span></span>
<span class="line"><span>             + setuptools (pip)</span></span>
<span class="line"><span>             + uv</span></span>
<span class="line"><span>             + xarray</span></span>
<span class="line"><span>    CondaPkg Initialising pixi</span></span>
<span class="line"><span>             │ /home/runner/.julia/artifacts/cefba4912c2b400756d043a2563ef77a0088866b/bin/pixi</span></span>
<span class="line"><span>             │ init</span></span>
<span class="line"><span>             │ --format pixi</span></span>
<span class="line"><span>             └ /home/runner/work/Comrade.jl/Comrade.jl/examples/intermediate/ClosureImaging/.CondaPkg</span></span>
<span class="line"><span>✔ Created /home/runner/work/Comrade.jl/Comrade.jl/examples/intermediate/ClosureImaging/.CondaPkg/pixi.toml</span></span>
<span class="line"><span>    CondaPkg Wrote /home/runner/work/Comrade.jl/Comrade.jl/examples/intermediate/ClosureImaging/.CondaPkg/pixi.toml</span></span>
<span class="line"><span>             │ [dependencies]</span></span>
<span class="line"><span>             │ openssl = &quot;&gt;=3, &lt;3.1&quot;</span></span>
<span class="line"><span>             │ uv = &quot;&gt;=0.4&quot;</span></span>
<span class="line"><span>             │ libstdcxx-ng = &quot;&gt;=3.4,&lt;13.0&quot;</span></span>
<span class="line"><span>             │ pandas = &quot;&lt;2&quot;</span></span>
<span class="line"><span>             │ xarray = &quot;*&quot;</span></span>
<span class="line"><span>             │ numpy = &quot;&gt;=1.24, &lt;2.0&quot;</span></span>
<span class="line"><span>             │ </span></span>
<span class="line"><span>             │     [dependencies.python]</span></span>
<span class="line"><span>             │     channel = &quot;conda-forge&quot;</span></span>
<span class="line"><span>             │     build = &quot;*cpython*&quot;</span></span>
<span class="line"><span>             │     version = &quot;&gt;=3.8,&lt;4, &gt;=3.6,&lt;=3.10&quot;</span></span>
<span class="line"><span>             │ </span></span>
<span class="line"><span>             │ [project]</span></span>
<span class="line"><span>             │ name = &quot;.CondaPkg&quot;</span></span>
<span class="line"><span>             │ platforms = [&quot;linux-64&quot;]</span></span>
<span class="line"><span>             │ channels = [&quot;conda-forge&quot;]</span></span>
<span class="line"><span>             │ channel-priority = &quot;strict&quot;</span></span>
<span class="line"><span>             │ description = &quot;automatically generated by CondaPkg.jl&quot;</span></span>
<span class="line"><span>             │ </span></span>
<span class="line"><span>             │ [pypi-dependencies]</span></span>
<span class="line"><span>             │ ehtim = &quot;&gt;=1.2.10, &lt;2.0&quot;</span></span>
<span class="line"><span>             │ numpy = &quot;&gt;=1.24, &lt;2.0&quot;</span></span>
<span class="line"><span>             └ setuptools = &quot;*&quot;</span></span>
<span class="line"><span>    CondaPkg Installing packages</span></span>
<span class="line"><span>             │ /home/runner/.julia/artifacts/cefba4912c2b400756d043a2563ef77a0088866b/bin/pixi</span></span>
<span class="line"><span>             │ install</span></span>
<span class="line"><span>             └ --manifest-path /home/runner/work/Comrade.jl/Comrade.jl/examples/intermediate/ClosureImaging/.CondaPkg/pixi.toml</span></span>
<span class="line"><span>✔ The default environment has been installed.</span></span></code></pre></div><p>For reproducibility we use a stable random number genreator</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StableRNGs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rng </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> StableRNG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>StableRNGs.LehmerRNG(state=0x000000000000000000000000000000f7)</span></span></code></pre></div><h2 id="Load-the-Data" tabindex="-1">Load the Data <a class="header-anchor" href="#Load-the-Data" aria-label="Permalink to &quot;Load the Data {#Load-the-Data}&quot;">​</a></h2><p>To download the data visit <a href="https://doi.org/10.25739/g85n-f134" target="_blank" rel="noreferrer">https://doi.org/10.25739/g85n-f134</a> To load the eht-imaging obsdata object we do:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ehtim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obsdata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">load_uvfits</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">joinpath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(__DIR, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;..&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;..&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SR1_M87_2017_096_lo_hops_netcal_StokesI.uvfits&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Python: &lt;ehtim.obsdata.Obsdata object at 0x7efc66975ab0&gt;</span></span></code></pre></div><p>Now we do some minor preprocessing:</p><ul><li><p>Scan average the data since the data have been preprocessed so that the gain phases are coherent.</p></li><li><p>Add 2% systematic noise to deal with calibration issues such as leakage.</p></li></ul><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> scan_average</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(obs)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">add_fractional_noise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.02</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Python: &lt;ehtim.obsdata.Obsdata object at 0x7efc67a32920&gt;</span></span></code></pre></div><p>Now, we extract our closure quantities from the EHT data set. We flag now SNR points since the closure likelihood we use is only applicable to high SNR data.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dlcamp, dcphase  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> extract_table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(obs, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LogClosureAmplitudes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;snrcut</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ClosurePhases</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;snrcut</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(EHTObservationTable{Comrade.EHTLogClosureAmplitudeDatum{:I}}</span></span>
<span class="line"><span>  source:      M87</span></span>
<span class="line"><span>  mjd:         57849</span></span>
<span class="line"><span>  bandwidth:   1.856e9</span></span>
<span class="line"><span>  sites:       [:AA, :AP, :AZ, :JC, :LM, :PV, :SM]</span></span>
<span class="line"><span>  nsamples:    128, EHTObservationTable{Comrade.EHTClosurePhaseDatum{:I}}</span></span>
<span class="line"><span>  source:      M87</span></span>
<span class="line"><span>  mjd:         57849</span></span>
<span class="line"><span>  bandwidth:   1.856e9</span></span>
<span class="line"><span>  sites:       [:AA, :AP, :AZ, :JC, :LM, :PV, :SM]</span></span>
<span class="line"><span>  nsamples:    152)</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Fitting low SNR closure data is complicated and requires a more sophisticated likelihood. If low-SNR data is very important we recommend fitting visibilties with a instrumental model.</p></div><h2 id="Build-the-Model/Posterior" tabindex="-1">Build the Model/Posterior <a class="header-anchor" href="#Build-the-Model/Posterior" aria-label="Permalink to &quot;Build the Model/Posterior {#Build-the-Model/Posterior}&quot;">​</a></h2><p>For our model, we will be using an image model that consists of a raster of point sources, convolved with some pulse or kernel to make a <code>ContinuousImage</code>. To define this model we define the standard two argument function <code>sky</code> that defines the sky model we want to fit. The first argument are the model parameters, and are typically a NamedTuple. The second argument defines the metadata for the model that is typically constant. For our model the constant <code>metdata</code> will just by the mean or prior image.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sky</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(θ, metadata)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (;fg, c, σimg) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> θ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (;mimg) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> metadata</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Apply the GMRF fluctuations to the image</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rast </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> apply_fluctuations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CenteredLR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), mimg, σimg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">params)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ContinuousImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(((</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fg))</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rast, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BSplinePulse{3}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Force the image centroid to be at the origin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    x0, y0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> centroid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(m)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Add a large-scale gaussian to deal with the over-resolved mas flux</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    g </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> modify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Gaussian</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Stretch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">250.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">250.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Renormalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fg))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> shifted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(m, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x0, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y0) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> g</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>sky (generic function with 1 method)</span></span></code></pre></div><p>Now, let&#39;s set up our image model. The EHT&#39;s nominal resolution is 20-25 μas. Additionally, the EHT is not very sensitive to a larger field of views; typically, 60-80 μas is enough to describe the compact flux of M87. Given this, we only need to use a small number of pixels to describe our image.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">npix </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fovxy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">150.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>7.27220521664304e-10</span></span></code></pre></div><p>To define the image model we need to specify both the grid we will be using and the FT algorithm we will use, in this case the NFFT which is the most efficient.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">grid </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imagepixels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fovxy, fovxy, npix, npix)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>RectiGrid(</span></span>
<span class="line"><span>executor: ComradeBase.Serial()</span></span>
<span class="line"><span>Dimensions: </span></span>
<span class="line"><span>(↓ X Sampled{Float64} LinRange{Float64}(-3.5224744018114725e-10, 3.5224744018114725e-10, 32) ForwardOrdered Regular Points,</span></span>
<span class="line"><span>→ Y Sampled{Float64} LinRange{Float64}(-3.5224744018114725e-10, 3.5224744018114725e-10, 32) ForwardOrdered Regular Points)</span></span>
<span class="line"><span>)</span></span></code></pre></div><p>Now we need to specify our image prior. For this work we will use a Gaussian Markov Random field prior</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> VLBIImagePriors, Distributions</span></span></code></pre></div><p>Since we are using a Gaussian Markov random field prior we need to first specify our <code>mean</code> image. For this work we will use a symmetric Gaussian with a FWHM of 50 μas</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fwhmfac </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sqrt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mpr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> modify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Gaussian</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Stretch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">./</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fwhmfac))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">imgpr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> intensitymap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mpr, grid)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">skymeta </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;mimg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> imgpr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">./</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">flux</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imgpr));</span></span></code></pre></div><p>Now we can finally form our image prior. For this we use a heirarchical prior where the direct log-ratio image prior is a Gaussian Markov Random Field. The correlation length of the GMRF is a hyperparameter that is fit during imaging. We pass the data to the prior to estimate what the maximumal resolutoin of the array is and prevent the prior from allowing correlation lengths that are much small than the telescope beam size. Note that this GMRF prior has unit variance. For more information on the GMRF prior see the <a href="/Comrade.jl/previews/PR397/api#Comrade.corr_image_prior"><code>corr_image_prior</code></a> doc string.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cprior </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> corr_image_prior</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(grid, dlcamp)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>HierarchicalPrior(</span></span>
<span class="line"><span>	map: </span></span>
<span class="line"><span>	ConditionalMarkov(</span></span>
<span class="line"><span>Random Field: VLBIImagePriors.GaussMarkovRandomField</span></span>
<span class="line"><span>Graph: MarkovRandomFieldGraph{1}(</span></span>
<span class="line"><span>dims: (32, 32)</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>)	hyper prior: </span></span>
<span class="line"><span>	Truncated(Distributions.InverseGamma{Float64}(</span></span>
<span class="line"><span>invd: Distributions.Gamma{Float64}(α=1.0, θ=0.0407685911951416)</span></span>
<span class="line"><span>θ: 24.528686684644875</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>; lower=1.0, upper=64.0)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>)</span></span></code></pre></div><p>Putting everything together the total prior is then our image prior, a prior on the standard deviation of the MRF, and a prior on the fractional flux of the Gaussian component.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">prior </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cprior, σimg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Exponential</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), fg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Uniform</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(c = HierarchicalPrior(</span></span>
<span class="line"><span>	map: </span></span>
<span class="line"><span>	ConditionalMarkov(</span></span>
<span class="line"><span>Random Field: VLBIImagePriors.GaussMarkovRandomField</span></span>
<span class="line"><span>Graph: MarkovRandomFieldGraph{1}(</span></span>
<span class="line"><span>dims: (32, 32)</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>)	hyper prior: </span></span>
<span class="line"><span>	Truncated(Distributions.InverseGamma{Float64}(</span></span>
<span class="line"><span>invd: Distributions.Gamma{Float64}(α=1.0, θ=0.0407685911951416)</span></span>
<span class="line"><span>θ: 24.528686684644875</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>; lower=1.0, upper=64.0)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>, σimg = Distributions.Exponential{Float64}(θ=0.1), fg = Distributions.Uniform{Float64}(a=0.0, b=1.0))</span></span></code></pre></div><p>We can then define our sky model.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">skym </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SkyModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sky, prior, grid; metadata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">skymeta)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SkyModel</span></span>
<span class="line"><span>  with map: sky</span></span>
<span class="line"><span>   on grid: ComradeBase.RectiGrid</span></span></code></pre></div><p>Since we are fitting closures we do not need to include an instrument model, since the closure likelihood is approximately independent of gains in the high SNR limit.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Enzyme</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">post </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> VLBIPosterior</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(skym, dlcamp, dcphase; admode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set_runtime_activity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Enzyme</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Reverse))</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>VLBIPosterior</span></span>
<span class="line"><span>ObservedSkyModel</span></span>
<span class="line"><span>  with map: sky</span></span>
<span class="line"><span>   on grid: VLBISkyModels.FourierDualDomainIdealInstrumentModelData Products: Comrade.EHTLogClosureAmplitudeDatumComrade.EHTClosurePhaseDatum</span></span></code></pre></div><h2 id="Reconstructing-the-Image" tabindex="-1">Reconstructing the Image <a class="header-anchor" href="#Reconstructing-the-Image" aria-label="Permalink to &quot;Reconstructing the Image {#Reconstructing-the-Image}&quot;">​</a></h2><p>To reconstruct the image we will first use the MAP estimate. This is approach is basically a re-implentation of regularized maximum likelihood (RML) imaging. However, unlike traditional RML imaging we also fit the regularizer hyperparameters, thanks to our interpretation of as our imaging prior as a hierarchical model.</p><p>To optimize our posterior <code>Comrade</code> provides the <code>comrade_opt</code> function. To use this functionality a user first needs to import <code>Optimization.jl</code> and the optimizer of choice. In this tutorial we will use Optim.jl&#39;s L-BFGS optimizer, which is defined in the sub-package OptimizationOptimJL. We also need to import Enzyme to allow for automatic differentiation.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Optimization</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OptimizationOptimJL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">xopt, sol </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> comrade_opt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LBFGS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        maxiters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, initial_params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">prior_sample</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rng, post));</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌ Warning: Using fallback BLAS replacements for ([&quot;cblas_zdotc_sub64_&quot;]), performance may be degraded</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/9hB1H/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/9hB1H/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/9hB1H/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [4] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/9hB1H/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/9hB1H/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/9hB1H/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/9hB1H/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [4] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/9hB1H/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span></code></pre></div><p>First we will evaluate our fit by plotting the residuals</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CairoMakie</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> residuals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post, xopt)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Figure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">axisfields</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fig[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], res[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:uvdist</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PNG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">axisfields</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fig[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], res[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:uvdist</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PNG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PNG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text</span></span></code></pre></div><p><img src="/Comrade.jl/previews/PR397/assets/ClosureImaging-42.DWfF6atv.png" alt=""></p><p>Now let&#39;s plot the MAP estimate.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imagepixels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">150.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">150.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">img </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> intensitymap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">skymodel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post, xopt), g)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imageviz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(img, size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">600</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span></code></pre></div><p><img src="/Comrade.jl/previews/PR397/assets/ClosureImaging-44.DHxhefo1.png" alt=""></p><p>That doesn&#39;t look great. This is pretty common for the sparse EHT data. In this case the MAP often drastically overfits the data, producing a image filled with artifacts. In addition, we note that the MAP itself is not invariant to the model parameterization. Namely, if we changed our prior to use a fully centered parameterization we would get a very different image. Fortunately, these issues go away when we sample from the posterior, and construct expectations of the posterior, like the mean image.</p><p>To sample from the posterior we will use HMC and more specifically the NUTS algorithm. For information about NUTS see Michael Betancourt&#39;s <a href="https://arxiv.org/abs/1701.02434" target="_blank" rel="noreferrer">notes</a>.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>For our <code>metric</code> we use a diagonal matrix due to easier tuning.</p></div><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AdvancedHMC</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chain </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sample</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rng, post, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NUTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">700</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; n_adapts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, progress</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, initial_params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">xopt);</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌ Warning: Using fallback BLAS replacements for ([&quot;cblas_zdotc_sub64_&quot;]), performance may be degraded</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/9hB1H/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/9hB1H/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/9hB1H/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [4] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/9hB1H/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/9hB1H/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/9hB1H/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/9hB1H/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [4] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/9hB1H/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/OGnEB/src/utils.jl:61</span></span>
<span class="line"><span>[ Info: Found initial step size 0.003125</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">Warning</p><p>This should be run for longer!</p></div><p>Now that we have our posterior, we can assess which parts of the image are strongly inferred by the data. This is rather unique to <code>Comrade</code> where more traditional imaging algorithms like CLEAN and RML are inherently unable to assess uncertainty in their reconstructions.</p><p>To explore our posterior let&#39;s first create images from a bunch of draws from the posterior</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msamples </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> skymodel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post), chain[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">501</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre></div><p>The mean image is then given by</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StatsBase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">imgs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> intensitymap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(msamples, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(g))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mimg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imgs)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">simg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imgs)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Figure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;resolution</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">700</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">700</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">axs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Axis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fig[i, j], xreversed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, aspect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, j </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">image!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(axs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], mimg, colormap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:afmhot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); axs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">title</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Mean&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">image!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(axs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], simg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">./</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(mimg, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1e-8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)), colorrange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), colormap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:afmhot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);axs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Std&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">image!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(axs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], imgs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],   colormap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:afmhot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">image!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(axs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], imgs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], colormap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:afmhot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">hidedecorations!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(axs)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PNG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text</span></span></code></pre></div><p><img src="/Comrade.jl/previews/PR397/assets/ClosureImaging-52.D9Uklpz-.png" alt=""></p><p>Now let&#39;s see whether our residuals look better.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Figure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ax1, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> baselineplot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fig[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], res[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:uvdist</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, label</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MAP residuals&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, axis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ylabel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;LCA Normalized Residuals&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, xlabel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;uvdist (Gλ)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ax2, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> baselineplot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fig[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], res[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:uvdist</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, label</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MAP residuals&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, axis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ylabel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CP Normalized Residuals&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, xlabel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;uvdist (Gλ)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sample</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chain[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">501</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> residuals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post, s)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    baselineplot!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ax1, rs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:uvdist</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:grey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, alpha</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, label</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Posterior Draw&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    baselineplot!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ax2, rs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:uvdist</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:grey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, alpha</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, label</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Posterior Draw&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">axislegend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ax1, merge</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PNG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text</span></span></code></pre></div><p><img src="/Comrade.jl/previews/PR397/assets/ClosureImaging-54.Br40ySbP.png" alt=""></p><p>And viola, you have a quick and preliminary image of M87 fitting only closure products. For a publication-level version we would recommend</p><ol><li><p>Running the chain longer and multiple times to properly assess things like ESS and R̂ (see <a href="/Comrade.jl/previews/PR397/tutorials/beginner/GeometricModeling#Geometric-Modeling-of-EHT-Data">Geometric Modeling of EHT Data</a>)</p></li><li><p>Fitting gains. Typically gain amplitudes are good to 10-20% for the EHT not the infinite uncertainty closures implicitly assume</p></li></ol><hr><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl" target="_blank" rel="noreferrer">Literate.jl</a>.</em></p></div></div></main><footer class="VPDocFooter" data-v-83890dd9 data-v-4f9813fa><!--[--><!--]--><div class="edit-info" data-v-4f9813fa><div class="edit-link" data-v-4f9813fa><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://https://github.com/ptiede/Comrade.jl/edit/main/docs/src/tutorials/intermediate/ClosureImaging.md" target="_blank" rel="noreferrer" data-v-4f9813fa><!--[--><span class="vpi-square-pen edit-link-icon" data-v-4f9813fa></span> Edit this page<!--]--></a></div><!----></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-4f9813fa><span class="visually-hidden" id="doc-footer-aria-label" data-v-4f9813fa>Pager</span><div class="pager" data-v-4f9813fa><a class="VPLink link pager-link prev" href="/Comrade.jl/previews/PR397/tutorials/beginner/GeometricModeling" data-v-4f9813fa><!--[--><span class="desc" data-v-4f9813fa>Previous page</span><span class="title" data-v-4f9813fa>Geometric Modeling of EHT Data</span><!--]--></a></div><div class="pager" data-v-4f9813fa><a class="VPLink link pager-link next" href="/Comrade.jl/previews/PR397/tutorials/intermediate/StokesIImaging" data-v-4f9813fa><!--[--><span class="desc" data-v-4f9813fa>Next page</span><span class="title" data-v-4f9813fa>Stokes I Simultaneous Image and Instrument Modeling</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-a9a9e638 data-v-c970a860><div class="container" data-v-c970a860><p class="message" data-v-c970a860>Made with <a href="https://luxdl.github.io/DocumenterVitepress.jl/dev/" target="_blank"><strong>DocumenterVitepress.jl</strong></a><br></p><p class="copyright" data-v-c970a860>© Copyright 2025.</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api.md\":\"Z-gCwOOB\",\"base_api.md\":\"CuaGscTE\",\"benchmarks.md\":\"BRTE4eBS\",\"conventions.md\":\"yCpgq8NK\",\"ext_ahmc.md\":\"DHLOVUp6\",\"ext_dynesty.md\":\"C7JDuSQK\",\"ext_optimization.md\":\"CucFGyXP\",\"ext_pigeons.md\":\"DXOMTo_k\",\"index.md\":\"DGx0GvMr\",\"interface.md\":\"DBavpl15\",\"introduction.md\":\"COCKdGze\",\"tutorials_advanced_hybridimaging.md\":\"DhdC8WuB\",\"tutorials_beginner_geometricmodeling.md\":\"CQYmc7d4\",\"tutorials_beginner_loadingdata.md\":\"SVb4hlHb\",\"tutorials_index.md\":\"CyA8MEPz\",\"tutorials_intermediate_closureimaging.md\":\"BEP1leop\",\"tutorials_intermediate_polarizedimaging.md\":\"6vHjryhg\",\"tutorials_intermediate_stokesiimaging.md\":\"D4V2VeXt\",\"vlbi_imaging_problem.md\":\"C_bJjhU_\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Comrade.jl\",\"description\":\"A VitePress Site\",\"base\":\"/Comrade.jl/previews/PR397/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"outline\":\"deep\",\"search\":{\"provider\":\"local\",\"options\":{\"detailedView\":true}},\"nav\":[{\"text\":\"Home\",\"link\":\"/index\"},{\"text\":\"Introduction\",\"link\":\"/introduction\"},{\"text\":\"Benchmarks\",\"link\":\"/benchmarks\"},{\"text\":\"Introduction to the VLBI Imaging Problem\",\"link\":\"/vlbi_imaging_problem\"},{\"text\":\"Conventions\",\"link\":\"/conventions\"},{\"text\":\"Tutorials\",\"collapsed\":false,\"items\":[{\"text\":\"Overview\",\"link\":\"/tutorials/index\"},{\"text\":\"Beginner\",\"collapsed\":false,\"items\":[{\"text\":\"Loading Data into Comrade\",\"link\":\"/tutorials/beginner/LoadingData\"},{\"text\":\"Geometric Modeling of EHT Data\",\"link\":\"/tutorials/beginner/GeometricModeling\"}]},{\"text\":\"Intermediate\",\"collapsed\":false,\"items\":[{\"text\":\"Imaging a Black Hole using only Closure Quantities\",\"link\":\"/tutorials/intermediate/ClosureImaging\"},{\"text\":\"Stokes I Simultaneous Image and Instrument Modeling\",\"link\":\"/tutorials/intermediate/StokesIImaging\"},{\"text\":\"Polarized Image and Instrumental Modeling\",\"link\":\"/tutorials/intermediate/PolarizedImaging\"}]},{\"text\":\"Advanced\",\"collapsed\":false,\"items\":[{\"text\":\"Hybrid Imaging of a Black Hole\",\"link\":\"/tutorials/advanced/HybridImaging\"}]}]},{\"text\":\"Extensions\",\"collapsed\":false,\"items\":[{\"text\":\"Optimization Extension\",\"link\":\"/ext/optimization\"},{\"text\":\"AdvancedHMC Extension\",\"link\":\"/ext/ahmc\"},{\"text\":\"Dynesty Extension\",\"link\":\"/ext/dynesty\"},{\"text\":\"Pigeons Extension\",\"link\":\"/ext/pigeons\"}]},{\"text\":\"Base API\",\"link\":\"/base_api\"},{\"text\":\"Comrade API\",\"link\":\"/api\"}],\"sidebar\":[{\"text\":\"Home\",\"link\":\"/index\"},{\"text\":\"Introduction\",\"link\":\"/introduction\"},{\"text\":\"Benchmarks\",\"link\":\"/benchmarks\"},{\"text\":\"Introduction to the VLBI Imaging Problem\",\"link\":\"/vlbi_imaging_problem\"},{\"text\":\"Conventions\",\"link\":\"/conventions\"},{\"text\":\"Tutorials\",\"collapsed\":false,\"items\":[{\"text\":\"Overview\",\"link\":\"/tutorials/index\"},{\"text\":\"Beginner\",\"collapsed\":false,\"items\":[{\"text\":\"Loading Data into Comrade\",\"link\":\"/tutorials/beginner/LoadingData\"},{\"text\":\"Geometric Modeling of EHT Data\",\"link\":\"/tutorials/beginner/GeometricModeling\"}]},{\"text\":\"Intermediate\",\"collapsed\":false,\"items\":[{\"text\":\"Imaging a Black Hole using only Closure Quantities\",\"link\":\"/tutorials/intermediate/ClosureImaging\"},{\"text\":\"Stokes I Simultaneous Image and Instrument Modeling\",\"link\":\"/tutorials/intermediate/StokesIImaging\"},{\"text\":\"Polarized Image and Instrumental Modeling\",\"link\":\"/tutorials/intermediate/PolarizedImaging\"}]},{\"text\":\"Advanced\",\"collapsed\":false,\"items\":[{\"text\":\"Hybrid Imaging of a Black Hole\",\"link\":\"/tutorials/advanced/HybridImaging\"}]}]},{\"text\":\"Extensions\",\"collapsed\":false,\"items\":[{\"text\":\"Optimization Extension\",\"link\":\"/ext/optimization\"},{\"text\":\"AdvancedHMC Extension\",\"link\":\"/ext/ahmc\"},{\"text\":\"Dynesty Extension\",\"link\":\"/ext/dynesty\"},{\"text\":\"Pigeons Extension\",\"link\":\"/ext/pigeons\"}]},{\"text\":\"Base API\",\"link\":\"/base_api\"},{\"text\":\"Comrade API\",\"link\":\"/api\"}],\"editLink\":{\"pattern\":\"https://https://github.com/ptiede/Comrade.jl/edit/main/docs/src/:path\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/ptiede/Comrade.jl\"}],\"footer\":{\"message\":\"Made with <a href=\\\"https://luxdl.github.io/DocumenterVitepress.jl/dev/\\\" target=\\\"_blank\\\"><strong>DocumenterVitepress.jl</strong></a><br>\",\"copyright\":\"© Copyright 2025.\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>