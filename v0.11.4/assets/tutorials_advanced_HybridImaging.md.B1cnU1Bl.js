import{_ as a,c as i,a5 as n,o as p}from"./chunks/framework.BmjlC9hS.js";const l="/Comrade.jl/v0.11.4/assets/HybridImaging-36.nU34q1cm.png",e="/Comrade.jl/v0.11.4/assets/HybridImaging-41.CYDKg_Id.png",t="/Comrade.jl/v0.11.4/assets/HybridImaging-43.BxS0vAty.png",h="/Comrade.jl/v0.11.4/assets/HybridImaging-52.CBAGVwAB.png",k="/Comrade.jl/v0.11.4/assets/HybridImaging-53.k3tC9piQ.png",r="/Comrade.jl/v0.11.4/assets/HybridImaging-55.CoaRpBe5.png",d="/Comrade.jl/v0.11.4/assets/HybridImaging-57.BWS3p4j_.png",g="/Comrade.jl/v0.11.4/assets/HybridImaging-59.CORJt3ue.png",b=JSON.parse('{"title":"Hybrid Imaging of a Black Hole","description":"","frontmatter":{},"headers":[],"relativePath":"tutorials/advanced/HybridImaging.md","filePath":"tutorials/advanced/HybridImaging.md","lastUpdated":null}'),E={name:"tutorials/advanced/HybridImaging.md"};function o(c,s,y,F,m,C){return p(),i("div",null,s[0]||(s[0]=[n(`<h1 id="Hybrid-Imaging-of-a-Black-Hole" tabindex="-1">Hybrid Imaging of a Black Hole <a class="header-anchor" href="#Hybrid-Imaging-of-a-Black-Hole" aria-label="Permalink to &quot;Hybrid Imaging of a Black Hole {#Hybrid-Imaging-of-a-Black-Hole}&quot;">​</a></h1><p>In this tutorial, we will use <strong>hybrid imaging</strong> to analyze the 2017 EHT data. By hybrid imaging, we mean decomposing the model into simple geometric models, e.g., rings and such, plus a rasterized image model to soak up the additional structure. This approach was first developed in <a href="https://iopscience.iop.org/article/10.3847/1538-4357/ab9c1f" target="_blank" rel="noreferrer"><code>BB20</code></a> and applied to EHT 2017 data. We will use a similar model in this tutorial.</p><h2 id="Introduction-to-Hybrid-modeling-and-imaging" tabindex="-1">Introduction to Hybrid modeling and imaging <a class="header-anchor" href="#Introduction-to-Hybrid-modeling-and-imaging" aria-label="Permalink to &quot;Introduction to Hybrid modeling and imaging {#Introduction-to-Hybrid-modeling-and-imaging}&quot;">​</a></h2><p>The benefit of using a hybrid-based modeling approach is the effective compression of information/parameters when fitting the data. Hybrid modeling requires the user to incorporate specific knowledge of how you expect the source to look like. For instance for M87, we expect the image to be dominated by a ring-like structure. Therefore, instead of using a high-dimensional raster to recover the ring, we can use a ring model plus a raster to soak up the additional degrees of freedom. This is the approach we will take in this tutorial to analyze the April 6 2017 EHT data of M87.</p><h2 id="Loading-the-Data" tabindex="-1">Loading the Data <a class="header-anchor" href="#Loading-the-Data" aria-label="Permalink to &quot;Loading the Data {#Loading-the-Data}&quot;">​</a></h2><p>To get started we will load Comrade</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Comrade</span></span></code></pre></div><h2 id="Load-the-Data" tabindex="-1">Load the Data <a class="header-anchor" href="#Load-the-Data" aria-label="Permalink to &quot;Load the Data {#Load-the-Data}&quot;">​</a></h2><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Pyehtim</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>    CondaPkg Found dependencies: /home/runner/.julia/packages/PythonCall/Nr75f/CondaPkg.toml</span></span>
<span class="line"><span>    CondaPkg Found dependencies: /home/runner/.julia/packages/Pyehtim/Za8ac/CondaPkg.toml</span></span>
<span class="line"><span>    CondaPkg Resolving changes</span></span>
<span class="line"><span>             + ehtim (pip)</span></span>
<span class="line"><span>             + libstdcxx-ng</span></span>
<span class="line"><span>             + numpy</span></span>
<span class="line"><span>             + numpy (pip)</span></span>
<span class="line"><span>             + openssl</span></span>
<span class="line"><span>             + pandas</span></span>
<span class="line"><span>             + pynfft</span></span>
<span class="line"><span>             + python</span></span>
<span class="line"><span>             + setuptools (pip)</span></span>
<span class="line"><span>             + uv</span></span>
<span class="line"><span>    CondaPkg Creating environment</span></span>
<span class="line"><span>             │ /home/runner/.julia/artifacts/7973f2c7725e2d0eef7a95159454c4145f0945a2/bin/micromamba</span></span>
<span class="line"><span>             │ -r /home/runner/.julia/scratchspaces/0b3b1443-0f03-428d-bdfb-f27f9c1191ea/root</span></span>
<span class="line"><span>             │ create</span></span>
<span class="line"><span>             │ -y</span></span>
<span class="line"><span>             │ -p /home/runner/work/Comrade.jl/Comrade.jl/examples/advanced/HybridImaging/.CondaPkg/env</span></span>
<span class="line"><span>             │ --override-channels</span></span>
<span class="line"><span>             │ --no-channel-priority</span></span>
<span class="line"><span>             │ libstdcxx-ng[version=&#39;&gt;=3.4,&lt;13.0&#39;]</span></span>
<span class="line"><span>             │ numpy[version=&#39;&gt;=1.24, &lt;2.0&#39;]</span></span>
<span class="line"><span>             │ openssl[version=&#39;&gt;=3, &lt;3.1&#39;]</span></span>
<span class="line"><span>             │ pandas[version=&#39;&lt;2&#39;]</span></span>
<span class="line"><span>             │ pynfft[version=&#39;&gt;1.0&#39;]</span></span>
<span class="line"><span>             │ python[version=&#39;&gt;=3.8,&lt;4&#39;,channel=&#39;conda-forge&#39;,build=&#39;*cpython*&#39;]</span></span>
<span class="line"><span>             │ python[version=&#39;&gt;=3.6,&lt;=3.10&#39;]</span></span>
<span class="line"><span>             │ uv[version=&#39;&gt;=0.4&#39;]</span></span>
<span class="line"><span>             └ -c conda-forge</span></span>
<span class="line"><span>conda-forge/linux-64                                        Using cache</span></span>
<span class="line"><span>conda-forge/noarch                                          Using cache</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Transaction</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Prefix: /home/runner/work/Comrade.jl/Comrade.jl/examples/advanced/HybridImaging/.CondaPkg/env</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Updating specs:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>   - libstdcxx-ng[version=&#39;&gt;=3.4,&lt;13.0&#39;]</span></span>
<span class="line"><span>   - numpy[version=&#39;&gt;=1.24, &lt;2.0&#39;]</span></span>
<span class="line"><span>   - openssl[version=&#39;&gt;=3, &lt;3.1&#39;]</span></span>
<span class="line"><span>   - pandas[version=&#39;&lt;2&#39;]</span></span>
<span class="line"><span>   - pynfft[version=&#39;&gt;1.0&#39;]</span></span>
<span class="line"><span>   - conda-forge::python[version=&#39;&gt;=3.8,&lt;4&#39;,build=*cpython*]</span></span>
<span class="line"><span>   - python[version=&#39;&gt;=3.6,&lt;=3.10&#39;]</span></span>
<span class="line"><span>   - uv[version=&#39;&gt;=0.4&#39;]</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Package                 Version  Build                Channel           Size</span></span>
<span class="line"><span>────────────────────────────────────────────────────────────────────────────────</span></span>
<span class="line"><span>  Install:</span></span>
<span class="line"><span>────────────────────────────────────────────────────────────────────────────────</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  + libstdcxx-ng           12.3.0  hc0a3c3a_7           conda-forge     Cached</span></span>
<span class="line"><span>  + _libgcc_mutex             0.1  conda_forge          conda-forge     Cached</span></span>
<span class="line"><span>  + python_abi               3.10  5_cp310              conda-forge     Cached</span></span>
<span class="line"><span>  + ca-certificates    2024.12.14  hbcca054_0           conda-forge     Cached</span></span>
<span class="line"><span>  + ld_impl_linux-64         2.43  h712a8e2_2           conda-forge     Cached</span></span>
<span class="line"><span>  + libgomp                14.2.0  h77fa898_1           conda-forge     Cached</span></span>
<span class="line"><span>  + _openmp_mutex             4.5  2_gnu                conda-forge     Cached</span></span>
<span class="line"><span>  + libgcc                 14.2.0  h77fa898_1           conda-forge     Cached</span></span>
<span class="line"><span>  + liblzma                 5.6.3  hb9d3cd8_1           conda-forge     Cached</span></span>
<span class="line"><span>  + libzlib                 1.3.1  hb9d3cd8_2           conda-forge     Cached</span></span>
<span class="line"><span>  + libgfortran5           14.2.0  hd5240d6_1           conda-forge     Cached</span></span>
<span class="line"><span>  + libstdcxx              14.2.0  hc0a3c3a_1           conda-forge     Cached</span></span>
<span class="line"><span>  + libgcc-ng              14.2.0  h69a702a_1           conda-forge     Cached</span></span>
<span class="line"><span>  + xz-tools                5.6.3  hb9d3cd8_1           conda-forge     Cached</span></span>
<span class="line"><span>  + xz-gpl-tools            5.6.3  hbcc6ac9_1           conda-forge     Cached</span></span>
<span class="line"><span>  + liblzma-devel           5.6.3  hb9d3cd8_1           conda-forge     Cached</span></span>
<span class="line"><span>  + libsqlite              3.47.2  hee588c1_0           conda-forge     Cached</span></span>
<span class="line"><span>  + libgfortran            14.2.0  h69a702a_1           conda-forge     Cached</span></span>
<span class="line"><span>  + uv                     0.5.11  h0f3a69f_0           conda-forge     Cached</span></span>
<span class="line"><span>  + tk                     8.6.13  noxft_h4845f30_101   conda-forge     Cached</span></span>
<span class="line"><span>  + ncurses                   6.5  he02047a_1           conda-forge     Cached</span></span>
<span class="line"><span>  + libuuid                2.38.1  h0b41bf4_0           conda-forge     Cached</span></span>
<span class="line"><span>  + libnsl                  2.0.1  hd590300_0           conda-forge     Cached</span></span>
<span class="line"><span>  + libffi                  3.4.2  h7f98852_5           conda-forge     Cached</span></span>
<span class="line"><span>  + bzip2                   1.0.8  h4bc722e_7           conda-forge     Cached</span></span>
<span class="line"><span>  + openssl                3.0.14  h4ab18f5_0           conda-forge     Cached</span></span>
<span class="line"><span>  + xz                      5.6.3  hbcc6ac9_1           conda-forge     Cached</span></span>
<span class="line"><span>  + libgfortran-ng         14.2.0  h69a702a_1           conda-forge     Cached</span></span>
<span class="line"><span>  + libopenblas            0.3.28  pthreads_h94d23a6_1  conda-forge     Cached</span></span>
<span class="line"><span>  + readline                  8.2  h8228510_1           conda-forge     Cached</span></span>
<span class="line"><span>  + fftw                   3.3.10  nompi_hf1063bd_110   conda-forge     Cached</span></span>
<span class="line"><span>  + libblas                 3.9.0  26_linux64_openblas  conda-forge     Cached</span></span>
<span class="line"><span>  + sqlite                 3.47.2  h9eae976_0           conda-forge     Cached</span></span>
<span class="line"><span>  + nfft                    3.2.4  hf8c457e_1000        conda-forge     Cached</span></span>
<span class="line"><span>  + libcblas                3.9.0  26_linux64_openblas  conda-forge     Cached</span></span>
<span class="line"><span>  + liblapack               3.9.0  26_linux64_openblas  conda-forge     Cached</span></span>
<span class="line"><span>  + tzdata                  2024b  hc8b5060_0           conda-forge     Cached</span></span>
<span class="line"><span>  + python                 3.10.0  h543edf9_3_cpython   conda-forge     Cached</span></span>
<span class="line"><span>  + wheel                  0.45.1  pyhd8ed1ab_1         conda-forge     Cached</span></span>
<span class="line"><span>  + setuptools             75.6.0  pyhff2d567_1         conda-forge     Cached</span></span>
<span class="line"><span>  + pip                    24.3.1  pyh8b19718_2         conda-forge     Cached</span></span>
<span class="line"><span>  + six                    1.17.0  pyhd8ed1ab_0         conda-forge     Cached</span></span>
<span class="line"><span>  + pytz                   2024.2  pyhd8ed1ab_1         conda-forge     Cached</span></span>
<span class="line"><span>  + python-dateutil   2.9.0.post0  pyhff2d567_1         conda-forge     Cached</span></span>
<span class="line"><span>  + numpy                  1.26.4  py310hb13e2d6_0      conda-forge     Cached</span></span>
<span class="line"><span>  + pynfft                  1.3.2  py310hde88566_1006   conda-forge     Cached</span></span>
<span class="line"><span>  + pandas                  1.5.3  py310h9b08913_1      conda-forge     Cached</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Summary:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Install: 47 packages</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Total download: 0 B</span></span>
<span class="line"><span></span></span>
<span class="line"><span>────────────────────────────────────────────────────────────────────────────────</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>Transaction starting</span></span>
<span class="line"><span>Linking libstdcxx-ng-12.3.0-hc0a3c3a_7</span></span>
<span class="line"><span>Linking _libgcc_mutex-0.1-conda_forge</span></span>
<span class="line"><span>Linking python_abi-3.10-5_cp310</span></span>
<span class="line"><span>Linking ca-certificates-2024.12.14-hbcca054_0</span></span>
<span class="line"><span>Linking ld_impl_linux-64-2.43-h712a8e2_2</span></span>
<span class="line"><span>Linking libgomp-14.2.0-h77fa898_1</span></span>
<span class="line"><span>Linking _openmp_mutex-4.5-2_gnu</span></span>
<span class="line"><span>Linking libgcc-14.2.0-h77fa898_1</span></span>
<span class="line"><span>Linking liblzma-5.6.3-hb9d3cd8_1</span></span>
<span class="line"><span>Linking libzlib-1.3.1-hb9d3cd8_2</span></span>
<span class="line"><span>Linking libgfortran5-14.2.0-hd5240d6_1</span></span>
<span class="line"><span>Linking libstdcxx-14.2.0-hc0a3c3a_1</span></span>
<span class="line"><span>warning  libmamba [libstdcxx-14.2.0-hc0a3c3a_1] The following files were already present in the environment:</span></span>
<span class="line"><span>    - lib/libstdc++.so</span></span>
<span class="line"><span>    - lib/libstdc++.so.6</span></span>
<span class="line"><span>    - share/licenses/libstdc++/RUNTIME.LIBRARY.EXCEPTION</span></span>
<span class="line"><span>Linking libgcc-ng-14.2.0-h69a702a_1</span></span>
<span class="line"><span>Linking xz-tools-5.6.3-hb9d3cd8_1</span></span>
<span class="line"><span>Linking xz-gpl-tools-5.6.3-hbcc6ac9_1</span></span>
<span class="line"><span>Linking liblzma-devel-5.6.3-hb9d3cd8_1</span></span>
<span class="line"><span>Linking libsqlite-3.47.2-hee588c1_0</span></span>
<span class="line"><span>Linking libgfortran-14.2.0-h69a702a_1</span></span>
<span class="line"><span>Linking uv-0.5.11-h0f3a69f_0</span></span>
<span class="line"><span>Linking tk-8.6.13-noxft_h4845f30_101</span></span>
<span class="line"><span>Linking ncurses-6.5-he02047a_1</span></span>
<span class="line"><span>Linking libuuid-2.38.1-h0b41bf4_0</span></span>
<span class="line"><span>Linking libnsl-2.0.1-hd590300_0</span></span>
<span class="line"><span>Linking libffi-3.4.2-h7f98852_5</span></span>
<span class="line"><span>Linking bzip2-1.0.8-h4bc722e_7</span></span>
<span class="line"><span>Linking openssl-3.0.14-h4ab18f5_0</span></span>
<span class="line"><span>Linking xz-5.6.3-hbcc6ac9_1</span></span>
<span class="line"><span>Linking libgfortran-ng-14.2.0-h69a702a_1</span></span>
<span class="line"><span>Linking libopenblas-0.3.28-pthreads_h94d23a6_1</span></span>
<span class="line"><span>Linking readline-8.2-h8228510_1</span></span>
<span class="line"><span>Linking fftw-3.3.10-nompi_hf1063bd_110</span></span>
<span class="line"><span>Linking libblas-3.9.0-26_linux64_openblas</span></span>
<span class="line"><span>Linking sqlite-3.47.2-h9eae976_0</span></span>
<span class="line"><span>Linking nfft-3.2.4-hf8c457e_1000</span></span>
<span class="line"><span>Linking libcblas-3.9.0-26_linux64_openblas</span></span>
<span class="line"><span>Linking liblapack-3.9.0-26_linux64_openblas</span></span>
<span class="line"><span>Linking tzdata-2024b-hc8b5060_0</span></span>
<span class="line"><span>Linking python-3.10.0-h543edf9_3_cpython</span></span>
<span class="line"><span>Linking wheel-0.45.1-pyhd8ed1ab_1</span></span>
<span class="line"><span>Linking setuptools-75.6.0-pyhff2d567_1</span></span>
<span class="line"><span>Linking pip-24.3.1-pyh8b19718_2</span></span>
<span class="line"><span>Linking six-1.17.0-pyhd8ed1ab_0</span></span>
<span class="line"><span>Linking pytz-2024.2-pyhd8ed1ab_1</span></span>
<span class="line"><span>Linking python-dateutil-2.9.0.post0-pyhff2d567_1</span></span>
<span class="line"><span>Linking numpy-1.26.4-py310hb13e2d6_0</span></span>
<span class="line"><span>Linking pynfft-1.3.2-py310hde88566_1006</span></span>
<span class="line"><span>Linking pandas-1.5.3-py310h9b08913_1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Transaction finished</span></span>
<span class="line"><span></span></span>
<span class="line"><span>To activate this environment, use:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    micromamba activate /home/runner/work/Comrade.jl/Comrade.jl/examples/advanced/HybridImaging/.CondaPkg/env</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Or to execute a single command in this environment, use:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    micromamba run -p /home/runner/work/Comrade.jl/Comrade.jl/examples/advanced/HybridImaging/.CondaPkg/env mycommand</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    CondaPkg Installing Pip packages</span></span>
<span class="line"><span>             │ /home/runner/work/Comrade.jl/Comrade.jl/examples/advanced/HybridImaging/.CondaPkg/env/bin/uv</span></span>
<span class="line"><span>             │ pip</span></span>
<span class="line"><span>             │ install</span></span>
<span class="line"><span>             │ ehtim &gt;=1.2.9, &lt;2.0</span></span>
<span class="line"><span>             │ numpy &gt;=1.24, &lt;2.0</span></span>
<span class="line"><span>             └ setuptools</span></span>
<span class="line"><span>Using Python 3.10.0 environment at: /home/runner/work/Comrade.jl/Comrade.jl/examples/advanced/HybridImaging/.CondaPkg/env</span></span>
<span class="line"><span>Resolved 36 packages in 20ms</span></span>
<span class="line"><span>Installed 30 packages in 86ms</span></span>
<span class="line"><span> + astropy==6.1.7</span></span>
<span class="line"><span> + astropy-iers-data==0.2024.12.23.0.33.24</span></span>
<span class="line"><span> + certifi==2024.12.14</span></span>
<span class="line"><span> + charset-normalizer==3.4.0</span></span>
<span class="line"><span> + contourpy==1.3.1</span></span>
<span class="line"><span> + cycler==0.12.1</span></span>
<span class="line"><span> + ehtim==1.2.9</span></span>
<span class="line"><span> + fonttools==4.55.3</span></span>
<span class="line"><span> + future==1.0.0</span></span>
<span class="line"><span> + h5py==3.12.1</span></span>
<span class="line"><span> + hdrhistogram==0.10.3</span></span>
<span class="line"><span> + idna==3.10</span></span>
<span class="line"><span> + jplephem==2.22</span></span>
<span class="line"><span> + kiwisolver==1.4.7</span></span>
<span class="line"><span> + matplotlib==3.10.0</span></span>
<span class="line"><span> + networkx==3.4.2</span></span>
<span class="line"><span> + packaging==24.2</span></span>
<span class="line"><span> + pandas-appender==0.9.8.4</span></span>
<span class="line"><span> + paramsurvey==0.4.20</span></span>
<span class="line"><span> + pbr==6.1.0</span></span>
<span class="line"><span> + pillow==11.0.0</span></span>
<span class="line"><span> + psutil==6.1.1</span></span>
<span class="line"><span> + pyerfa==2.0.1.5</span></span>
<span class="line"><span> + pyparsing==3.2.0</span></span>
<span class="line"><span> + pyyaml==6.0.2</span></span>
<span class="line"><span> + requests==2.32.3</span></span>
<span class="line"><span> + scipy==1.13.1</span></span>
<span class="line"><span> + sgp4==2.23</span></span>
<span class="line"><span> + skyfield==1.49</span></span>
<span class="line"><span> + urllib3==2.3.0</span></span></code></pre></div><p>For reproducibility we use a stable random number genreator</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StableRNGs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rng </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> StableRNG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>StableRNGs.LehmerRNG(state=0x00000000000000000000000000000017)</span></span></code></pre></div><p>To download the data visit <a href="https://doi.org/10.25739/g85n-f134" target="_blank" rel="noreferrer">https://doi.org/10.25739/g85n-f134</a> To load the eht-imaging obsdata object we do:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ehtim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obsdata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">load_uvfits</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">joinpath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(__DIR, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;..&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;..&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SR1_M87_2017_096_lo_hops_netcal_StokesI.uvfits&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Python: &lt;ehtim.obsdata.Obsdata object at 0x7f05ea77e470&gt;</span></span></code></pre></div><p>Now we do some minor preprocessing:</p><ul><li>Scan average the data since the data have been preprocessed so that the gain phases coherent.</li></ul><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> scan_average</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(obs)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">add_fractional_noise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.02</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Python: &lt;ehtim.obsdata.Obsdata object at 0x7f05ead785e0&gt;</span></span></code></pre></div><p>For this tutorial we will once again fit complex visibilities since they provide the most information once the telescope/instrument model are taken into account.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dvis  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> extract_table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(obs, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Visibilities</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>EHTObservationTable{Comrade.EHTVisibilityDatum{:I}}</span></span>
<span class="line"><span>  source:      M87</span></span>
<span class="line"><span>  mjd:         57849</span></span>
<span class="line"><span>  bandwidth:   1.856e9</span></span>
<span class="line"><span>  sites:       [:AA, :AP, :AZ, :JC, :LM, :PV, :SM]</span></span>
<span class="line"><span>  nsamples:    274</span></span></code></pre></div><h2 id="Building-the-Model/Posterior" tabindex="-1">Building the Model/Posterior <a class="header-anchor" href="#Building-the-Model/Posterior" aria-label="Permalink to &quot;Building the Model/Posterior {#Building-the-Model/Posterior}&quot;">​</a></h2><p>Now we build our intensity/visibility model. That is, the model that takes in a named tuple of parameters and perhaps some metadata required to construct the model. For our model, we will use a raster or <code>ContinuousImage</code> model, an <code>m-ring</code> model, and a large asymmetric Gaussian component to model the unresolved short-baseline flux.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sky</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(θ, metadata)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (;c, σimg, f, r, σ, ma, mp, fg) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> θ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (;ftot, grid) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> metadata</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Form the image model</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # First transform to simplex space first applying the non-centered transform</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rast </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ftot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fg))</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">to_simplex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CenteredLR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), σimg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">c)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    mimg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ContinuousImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rast, grid, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BSplinePulse{3}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Form the ring model</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    α </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ma</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(mp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    β </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ma</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(mp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ring </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> smoothed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">modify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MRing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(α, β), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Stretch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(r), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Renormalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((ftot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">f)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fg)))), σ)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gauss </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> modify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Gaussian</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Stretch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">250.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Renormalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ftot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fg))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # We group the geometric models together for improved efficiency. This will be</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # automated in future versions.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mimg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ring </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gauss)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>sky (generic function with 1 method)</span></span></code></pre></div><p>Unlike other imaging examples (e.g., <a href="/Comrade.jl/v0.11.4/tutorials/intermediate/ClosureImaging#Imaging-a-Black-Hole-using-only-Closure-Quantities">Imaging a Black Hole using only Closure Quantities</a>) we also need to include a model for the instrument, i.e., gains as well. The gains will be broken into two components</p><ul><li><p>Gain amplitudes which are typically known to 10-20%, except for LMT, which has amplitudes closer to 50-100%.</p></li><li><p>Gain phases which are more difficult to constrain and can shift rapidly.</p></li></ul><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> VLBIImagePriors</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Distributions</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fgain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> exp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1im</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">G </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SingleStokesGain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fgain)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">intpr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ArrayPrior</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IIDSitePrior</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ScanSeg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Normal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)); LM </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> IIDSitePrior</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ScanSeg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Normal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ArrayPrior</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IIDSitePrior</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ScanSeg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DiagonalVonMises</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">inv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">π</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))); refant</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SEFDReference</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">intmodel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> InstrumentModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(G, intpr)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>InstrumentModel</span></span>
<span class="line"><span>  with Jones: SingleStokesGain</span></span>
<span class="line"><span>  with reference basis: PolarizedTypes.CirBasis()</span></span></code></pre></div><p>Before we move on, let&#39;s go into the <code>model</code> function a bit. This function takes two arguments <code>θ</code> and <code>metadata</code>. The <code>θ</code> argument is a named tuple of parameters that are fit to the data. The <code>metadata</code> argument is all the ancillary information we need to construct the model. For our hybrid model, we will need two variables for the metadata, a <code>grid</code> that specifies the locations of the image pixels and a <code>cache</code> that defines the algorithm used to calculate the visibilities given the image model. This is required since <code>ContinuousImage</code> is most easily computed using number Fourier transforms like the <a href="https://github.com/JuliaMath/NFFT.jl" target="_blank" rel="noreferrer"><code>NFFT</code></a> or <a href="https://github.com/JuliaMath/FFTW.jl" target="_blank" rel="noreferrer">FFT</a>. To combine the models, we use <code>Comrade</code>&#39;s overloaded <code>+</code> operators, which will combine the images such that their intensities and visibilities are added pointwise.</p><p>Now let&#39;s define our metadata. First we will define the cache for the image. This is required to compute the numerical Fourier transform.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fovxy  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">npix   </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g      </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imagepixels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fovxy, fovxy, npix, npix)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>RectiGrid(</span></span>
<span class="line"><span>executor: ComradeBase.Serial()</span></span>
<span class="line"><span>Dimensions: </span></span>
<span class="line"><span>(↓ X Sampled{Float64} LinRange{Float64}(-4.69663253574863e-10, 4.69663253574863e-10, 32) ForwardOrdered Regular Points,</span></span>
<span class="line"><span>→ Y Sampled{Float64} LinRange{Float64}(-4.69663253574863e-10, 4.69663253574863e-10, 32) ForwardOrdered Regular Points)</span></span>
<span class="line"><span>)</span></span></code></pre></div><p>Part of hybrid imaging is to force a scale separation between the different model components to make them identifiable. To enforce this we will set the raster component to have a correlation length of 5 times the beam size.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">beam </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> beamsize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dvis)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (beam</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">step</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(g</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X)))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cprior </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> GaussMarkovRandomField</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rat, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(g))</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>VLBIImagePriors.GaussMarkovRandomField(</span></span>
<span class="line"><span>Graph: MarkovRandomFieldGraph{1}(</span></span>
<span class="line"><span>dims: (32, 32)</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>Correlation Parameter: 19.9737623915157</span></span>
<span class="line"><span>)</span></span></code></pre></div><p>For the other parameters we use a uniform priors for the ring fractional flux <code>f</code> ring radius <code>r</code>, ring width <code>σ</code>, and the flux fraction of the Gaussian component <code>fg</code> and the amplitude for the ring brightness modes. For the angular variables <code>ξτ</code> and <code>ξ</code> we use the von Mises prior with concentration parameter <code>inv(π^2)</code> which is essentially a uniform prior on the circle. Finally for the standard deviation of the MRF we use a half-normal distribution. This is to ensure that the MRF has small differences from the mean image.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">skyprior </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          c  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cprior,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          σimg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> truncated</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Normal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); lower</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.01</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          f  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Uniform</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          r  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Uniform</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          σ  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Uniform</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          ma </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ntuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Uniform</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          mp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ntuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DiagonalVonMises</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">inv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">π</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          fg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Uniform</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(c = VLBIImagePriors.GaussMarkovRandomField(</span></span>
<span class="line"><span>Graph: MarkovRandomFieldGraph{1}(</span></span>
<span class="line"><span>dims: (32, 32)</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>Correlation Parameter: 19.9737623915157</span></span>
<span class="line"><span>), σimg = Truncated(Distributions.Normal{Float64}(μ=0.0, σ=0.1); lower=0.01), f = Distributions.Uniform{Float64}(a=0.0, b=1.0), r = Distributions.Uniform{Float64}(a=4.84813681109536e-11, b=1.454441043328608e-10), σ = Distributions.Uniform{Float64}(a=4.848136811095359e-13, b=4.84813681109536e-11), ma = (Distributions.Uniform{Float64}(a=0.0, b=0.5), Distributions.Uniform{Float64}(a=0.0, b=0.5)), mp = (VLBIImagePriors.DiagonalVonMises{Float64, Float64, Float64}(μ=0.0, κ=0.10132118364233778, lnorm=-1.739120733481688), VLBIImagePriors.DiagonalVonMises{Float64, Float64, Float64}(μ=0.0, κ=0.10132118364233778, lnorm=-1.739120733481688)), fg = Distributions.Uniform{Float64}(a=0.0, b=1.0))</span></span></code></pre></div><p>Now we form the metadata</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">skymetadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;ftot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, grid </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> g)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">skym </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SkyModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sky, skyprior, g; metadata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">skymetadata)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SkyModel</span></span>
<span class="line"><span>  with map: sky</span></span>
<span class="line"><span>   on grid: ComradeBase.RectiGrid</span></span></code></pre></div><p>This is everything we need to specify our posterior distribution, which our is the main object of interest in image reconstructions when using Bayesian inference.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Enzyme</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">post </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> VLBIPosterior</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(skym, intmodel, dvis; admode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set_runtime_activity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Enzyme</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Reverse))</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>VLBIPosterior</span></span>
<span class="line"><span>ObservedSkyModel</span></span>
<span class="line"><span>  with map: sky</span></span>
<span class="line"><span>   on grid: VLBISkyModels.FourierDualDomainObservedInstrumentModel</span></span>
<span class="line"><span>  with Jones: SingleStokesGain</span></span>
<span class="line"><span>  with reference basis: PolarizedTypes.CirBasis()Data Products: Comrade.EHTVisibilityDatum</span></span></code></pre></div><p>We can sample from the prior to see what the model looks like</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CairoMakie </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">xrand </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> prior_sample</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rng, post)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gpl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imagepixels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">μas2rad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imageviz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">intensitymap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">skymodel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post, xrand), gpl));</span></span></code></pre></div><p><img src="`+l+`" alt=""></p><h2 id="Reconstructing-the-Image" tabindex="-1">Reconstructing the Image <a class="header-anchor" href="#Reconstructing-the-Image" aria-label="Permalink to &quot;Reconstructing the Image {#Reconstructing-the-Image}&quot;">​</a></h2><p>To find the image we will demonstrate two methods:</p><ul><li><p>Optimization to find the MAP (fast but often a poor estimator)</p></li><li><p>Sampling to find the posterior (slow but provides a substantially better estimator)</p></li></ul><p>For optimization we will use the <code>Optimization.jl</code> package and the LBFGS optimizer. To use this we use the <a href="/Comrade.jl/v0.11.4/api#Comrade.comrade_opt"><code>comrade_opt</code></a> function</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Optimization</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OptimizationOptimJL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">xopt, sol </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> comrade_opt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LBFGS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        initial_params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">xrand, maxiters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, g_tol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1e0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/KLKnN/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/KLKnN/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/KLKnN/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [4] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/KLKnN/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/KLKnN/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/KLKnN/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:293</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [4] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [5] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/KLKnN/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span>
<span class="line"><span>┌ Warning: TODO forward zero-set of arraycopy used memset rather than runtime type </span></span>
<span class="line"><span>│ Caused by:</span></span>
<span class="line"><span>│ Stacktrace:</span></span>
<span class="line"><span>│  [1] copy</span></span>
<span class="line"><span>│    @ ./array.jl:411</span></span>
<span class="line"><span>│  [2] map</span></span>
<span class="line"><span>│    @ ./tuple.jl:294</span></span>
<span class="line"><span>│  [3] map</span></span>
<span class="line"><span>│    @ ./namedtuple.jl:265</span></span>
<span class="line"><span>│  [4] copy</span></span>
<span class="line"><span>│    @ ~/.julia/packages/StructArrays/KLKnN/src/structarray.jl:467</span></span>
<span class="line"><span>└ @ Enzyme.Compiler ~/.julia/packages/GPUCompiler/GnbhK/src/utils.jl:59</span></span></code></pre></div><p>First we will evaluate our fit by plotting the residuals</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Plots</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> residual</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post, xopt);</span></span></code></pre></div><p><img src="`+e+'" alt=""></p><p>These residuals suggest that we are substantially overfitting the data. This is a common side effect of MAP imaging. As a result if we plot the image we see that there is substantial high-frequency structure in the image that isn&#39;t supported by the data.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imageviz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">intensitymap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">skymodel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post, xopt), gpl), figure</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;resolution</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),));</span></span></code></pre></div><p><img src="'+t+`" alt=""></p><p>To improve our results we will now move to Posterior sampling. This is the main method we recommend for all inference problems in <code>Comrade</code>. While it is slower the results are often substantially better. To sample we will use the <code>AdvancedHMC</code> package.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AdvancedHMC</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chain </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sample</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rng, post, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NUTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">700</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; n_adapts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, progress</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, initial_params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">xopt);</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[ Info: Found initial step size 0.0027343750000000003</span></span></code></pre></div><p>We then remove the adaptation/warmup phase from our chain</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chain </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chain[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">501</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>PosteriorSamples</span></span>
<span class="line"><span>  Samples size: (200,)</span></span>
<span class="line"><span>  sampler used: AHMC</span></span>
<span class="line"><span>Mean</span></span>
<span class="line"><span>┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│ sky                                                                                                                                                                                                                                                                                                                             │ instrument                                                                                                                                                                                                                                                                                                                                                                                                                              │</span></span>
<span class="line"><span>│ @NamedTuple{c::Matrix{Float64}, σimg::Float64, f::Float64, r::Float64, σ::Float64, ma::Tuple{Float64, Float64}, mp::Tuple{Float64, Float64}, fg::Float64}                                                                                                                                                                       │ @NamedTuple{lg::Comrade.SiteArray{Float64, 1, Vector{Float64}, Vector{Comrade.IntegrationTime{Int64, Float64}}, Vector{Comrade.FrequencyChannel{Float64, Int64}}, Vector{Symbol}}, gp::Comrade.SiteArray{Float64, 1, Vector{Float64}, Vector{Comrade.IntegrationTime{Int64, Float64}}, Vector{Comrade.FrequencyChannel{Float64, Int64}}, Vector{Symbol}}}                                                                               │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│ (c = [-0.0115853 -0.0458529 … -0.249422 -0.174394; -0.0123847 -0.0897803 … -0.337653 -0.235003; … ; 0.0286168 0.0347422 … -0.142957 -0.13; 0.0583419 0.0670288 … -0.0697931 -0.055578], σimg = 0.973249, f = 0.980201, r = 1.13346e-10, σ = 2.38271e-11, ma = (0.256416, 0.25302), mp = (0.0797117, -0.357203), fg = 0.0259018) │ (lg = [0.0602773, 0.069584, 0.00725872, 0.0282711, -0.276449, 0.214057, 0.00229122, 0.0309273, -0.111717, 0.165762  …  -0.0188873, 0.0163162, -0.821824, 0.0111965, 0.0119894, 0.0253007, -0.0815212, 0.0220548, -0.866276, 0.0107568], gp = [0.0, 0.580595, 0.0, -2.18781, -0.732283, 0.64326, 0.0, -2.24131, -0.601953, 0.703715  …  0.364625, -0.811635, 0.901668, 0.810461, 0.0, -1.83011, 1.07427, -0.905795, 0.672882, 0.714068]) │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></span>
<span class="line"><span>Std. Dev.</span></span>
<span class="line"><span>┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│ sky                                                                                                                                                                                                                                                                                                      │ instrument                                                                                                                                                                                                                                                                                                                                                                                                              │</span></span>
<span class="line"><span>│ @NamedTuple{c::Matrix{Float64}, σimg::Float64, f::Float64, r::Float64, σ::Float64, ma::Tuple{Float64, Float64}, mp::Tuple{Float64, Float64}, fg::Float64}                                                                                                                                                │ @NamedTuple{lg::Comrade.SiteArray{Float64, 1, Vector{Float64}, Vector{Comrade.IntegrationTime{Int64, Float64}}, Vector{Comrade.FrequencyChannel{Float64, Int64}}, Vector{Symbol}}, gp::Comrade.SiteArray{Float64, 1, Vector{Float64}, Vector{Comrade.IntegrationTime{Int64, Float64}}, Vector{Comrade.FrequencyChannel{Float64, Int64}}, Vector{Symbol}}}                                                               │</span></span>
<span class="line"><span>├──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│ (c = [0.547809 0.54991 … 0.59208 0.464379; 0.601469 0.63575 … 0.631877 0.55408; … ; 0.608163 0.618831 … 0.613839 0.537367; 0.543361 0.605187 … 0.612043 0.508997], σimg = 0.048609, f = 0.0154834, r = 2.18389e-11, σ = 1.42866e-11, ma = (0.142561, 0.150517), mp = (1.56858, 1.58093), fg = 0.0220165) │ (lg = [0.141795, 0.146629, 0.0191845, 0.020035, 0.0852222, 0.0600872, 0.0183315, 0.0198151, 0.082432, 0.059322  …  0.0560514, 0.0206548, 0.0667249, 0.0147648, 0.018172, 0.0191585, 0.0644691, 0.0190257, 0.0682383, 0.0174461], gp = [0.0, 2.12518, 0.0, 0.0168664, 0.377764, 2.07117, 0.0, 0.0180875, 0.369737, 2.00197  …  2.76413, 1.01658, 0.318118, 2.00214, 0.0, 0.0182426, 2.53781, 1.00002, 0.305282, 2.0158]) │</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">Warning</p><p>This should be run for 4-5x more steps to properly estimate expectations of the posterior</p></div><p>Now lets plot the mean image and standard deviation images. To do this we first clip the first 250 MCMC steps since that is during tuning and so the posterior is not sampling from the correct sitesary distribution.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StatsBase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msamples </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> skymodel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(post), chain[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">begin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre></div><p>The mean image is then given by</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">imgs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> intensitymap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(msamples, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(gpl))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imageviz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">mean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imgs), colormap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:afmhot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span></code></pre></div><p><img src="`+h+'" alt=""></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> imageviz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imgs), colormap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:batlow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span></code></pre></div><p><img src="'+k+`" alt=""></p><p>We can also split up the model into its components and analyze each separately</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">comp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Comrade</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">components</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(msamples)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ring_samples </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> getindex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(comp, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rast_samples </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> first</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(comp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ring_imgs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> intensitymap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(ring_samples, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(gpl));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rast_imgs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> intensitymap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(rast_samples, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(gpl));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ring_mean, ring_std </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mean_and_std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ring_imgs);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rast_mean, rast_std </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mean_and_std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rast_imgs);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Figure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; resolution</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">axes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Axis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fig[i, j], xreversed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, aspect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DataAspect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, j </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">image!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(axes[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], ring_mean, colormap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:afmhot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); axes[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Ring Mean&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">image!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(axes[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], ring_std, colormap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:afmhot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); axes[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Ring Std. Dev.&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">image!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(axes[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], rast_mean, colormap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:afmhot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); axes[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Rast Mean&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">image!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(axes[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], rast_std</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">./</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rast_mean, colormap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:afmhot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); axes[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Rast std/mean&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">hidedecorations!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(axes)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PNG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DisplayAs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Text</span></span></code></pre></div><p><img src="`+r+`" alt=""></p><p>Finally, let&#39;s take a look at some of the ring parameters</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">figd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Figure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;resolution</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">650</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">p1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">density</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(figd[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rad2μas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sky</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">r)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, axis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(xlabel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Ring Diameter (μas)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">p2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">density</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(figd[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rad2μas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sky</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">σ)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sqrt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)), axis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(xlabel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Ring FWHM (μas)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">p3 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">density</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(figd[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rad2deg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(chain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sky</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mp.:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 360.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, axis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(xlabel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Ring PA (deg) E of N&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">p4 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">density</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(figd[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sky</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ma.:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, axis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(xlabel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Brightness asymmetry&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">p5 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">density</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(figd[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> .-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sky</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">f, axis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(xlabel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Ring flux fraction&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,))</span></span></code></pre></div><p><img src="`+d+`" alt=""></p><p>Now let&#39;s check the residuals using draws from the posterior</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Plots</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sample</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chain, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    residual!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p, post, s, legend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><p><img src="`+g+'" alt=""></p><p>And everything looks pretty good! Now comes the hard part: interpreting the results...</p><hr><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl" target="_blank" rel="noreferrer">Literate.jl</a>.</em></p>',88)]))}const f=a(E,[["render",o]]);export{b as __pageData,f as default};
